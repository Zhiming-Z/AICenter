# RAG 实施计划 v1.1

> **定位**：时间线、步骤、验证标准、资源需求

---

## 目录

1. [整体规划](#一整体规划)
2. [各阶段详细步骤](#二各阶段详细步骤)
3. [资源需求](#三资源需求)
4. [风险与应对](#四风险与应对)
5. [检查点与里程碑](#五检查点与里程碑)
6. [下一步行动](#六下一步行动)

---

## 一、整体规划

### 1.1 原流程问题分析

| 问题   | 说明                    | 改进建议           |
| ---- | --------------------- | -------------- |
| 任务顺序 | Docker 部署 → 源码部署顺序不合理 | 源码部署应提前，便于深度理解 |
| 文档时机 | 功能文档在理解前输出            | 应在源码部署和理解之后输出  |
| 缺失环节 | 缺少 PoC 验证阶段           | 增加原型验证与性能评估阶段  |

### 1.2 优化后的六阶段流程

```
┌─────────────────────────────────────────────────────────────────┐
│ 阶段1: 环境搭建与基础理解 (1-2周)                                │
├─────────────────────────────────────────────────────────────────┤
│ 阶段2: 解析方法深入研究 (1周)                                    │
├─────────────────────────────────────────────────────────────────┤
│ 阶段3: 元数据与知识库管理 (1周)                                  │
├─────────────────────────────────────────────────────────────────┤
│ 阶段4: 测试数据集构建 (1-2周)                                    │
├─────────────────────────────────────────────────────────────────┤
│ 阶段5: 评估体系建立 (1-2周)                                      │
├─────────────────────────────────────────────────────────────────┤
│ 阶段6: 原型验证与优化 (2-3周)                                    │
└─────────────────────────────────────────────────────────────────┘
```

### 1.3 时间线总览

| 阶段             | 时长   | 累计    |
| -------------- | ---- | ----- |
| 阶段1: 环境搭建与基础理解 | 1-2周 | 1-2周  |
| 阶段2: 解析方法深入研究  | 1周   | 2-3周  |
| 阶段3: 元数据与知识库管理 | 1周   | 3-4周  |
| 阶段4: 测试数据集构建   | 1-2周 | 4-6周  |
| 阶段5: 评估体系建立    | 1-2周 | 5-8周  |
| 阶段6: 原型验证与优化   | 2-3周 | 7-11周 |

---

## 二、各阶段详细步骤

### 阶段1: 环境搭建与基础理解（1-2周）

#### 输入

- RAGFlow 开源项目
- 现有业务文档样例

#### 输出

- 可运行的 RAGFlow 环境（Docker + 源码）
- 核心功能理解文档
- 技术栈架构图

#### 验证标准

- [ ] Docker 环境所有服务正常启动
- [ ] 管理后台可正常访问（端口 9831）
- [ ] 能创建知识库并上传文档
- [ ] 能创建对话并提问
- [ ] 源码环境可调试

#### 详细步骤

**1.1 Docker 快速部署**

```bash
# 启动完整 Docker 环境
cd docker
docker compose -f docker-compose.yml up -d

# 检查服务状态
docker ps
docker logs -f ragflow-server

# 访问管理界面 (默认端口: 9831)
```

**1.2 源码部署**

参考 `@reference/源码启动 ragflow 使用说明.md`

**关键配置文件**：
| 文件 | 用途 |
|------|------|
| `docker/.env` | 环境变量配置 |
| `docker/service_conf.yaml.template` | 服务配置模板 |
| `pyproject.toml` | Python 依赖管理 |

**1.3 核心功能探索**

| 模块        | 文件路径                         | 功能说明          |
| --------- | ---------------------------- | ------------- |
| 知识库管理     | `api/apps/kb_app.py`         | 知识库 CRUD、权限管理 |
| 对话系统      | `api/apps/dialog_app.py`     | 对话创建、知识库关联    |
| 文档处理      | `api/apps/document_app.py`   | 文档上传、解析、管理    |
| 评估系统      | `api/apps/evaluation_app.py` | 测试集、评估运行、结果分析 |
| Agent 工作流 | `api/apps/canvas_app.py`     | 工作流编排、组件管理    |

---

### 阶段2: 解析方法深入研究（1周）

#### 输入

- RAGFlow 源码环境
- 代表性业务文档（PDF、Excel、PPT、长文档等）

#### 输出

- 解析器对比测试报告
- 不同文档类型的推荐配置
- 解析效果问题清单

#### 验证标准

- [ ] 完成三种解析器功能测试
- [ ] 产出解析器对比表
- [ ] 确定各类型文档的推荐配置
- [ ] 记录解析过程中的问题

#### 详细步骤

**2.1 解析器功能测试**

| 解析器     | 文件路径               | 适用场景               |
| ------- | ------------------ | ------------------ |
| General | `rag/app/naive.py` | 通用文档（PDF/DOCX/TXT） |
| Book    | `rag/app/book.py`  | 长文档、书籍、手册          |
| Table   | `rag/app/table.py` | 表格数据（Excel/CSV）    |

**2.2 版面识别方案对比**

| 方案         | 速度  | 质量  | 适用场景 |
| ---------- | --- | --- | ---- |
| DeepDOC    | 中   | 高   | 通用文档 |
| MinerU     | 慢   | 最高  | 复杂布局 |
| Docling    | 中   | 高   | 学术论文 |
| Plain Text | 快   | 基础  | 简单文档 |

**2.3 推荐配置测试**

| 文档类型         | 推荐解析器 | 推荐版面识别         | chunk_token_num |
| ------------ | ----- | -------------- | --------------- |
| 普通 PDF/DOCX  | naive | DeepDOC        | 512             |
| 学术论文         | paper | MinerU/Docling | 512             |
| 书籍/长文档       | book  | DeepDOC        | 256             |
| Excel/CSV 表格 | table | -              | -               |

---

### 阶段3: 元数据与知识库管理（1周）

#### 输入

- RAGFlow 源码环境
- 业务元数据需求

#### 输出

- 元数据管理方案
- 知识库组织架构
- 文档选择机制设计

#### 验证标准

- [ ] 完成元数据功能测试
- [ ] 产出知识库组织方案
- [ ] 确定文档选择策略
- [ ] 编写元数据使用指南

#### 详细步骤

**3.1 元数据功能测试**

- 测试元数据添加、查询、过滤
- 验证元数据在检索中的作用
- 测试文档级别和知识库级别的元数据管理

**3.2 知识库架构设计**

- 统一知识库 vs 分类知识库
- 知识库之间的关联关系
- 权限管理策略

**3.3 文档选择机制**

- 对话级别知识库选择
- 搜索级别文档过滤
- 元数据驱动的智能过滤

---

### 阶段4: 测试数据集构建（1-2周）

#### 输入

- 业务文档样本（10-20份）
- 业务专家支持

#### 输出

- 小规模评测数据集（50-100个问题）
- 问题类型分类体系
- 标注规范文档

#### 验证标准

- [ ] 覆盖6种问题类型
- [ ] 每种类型至少10-15个问题
- [ ] 完成 relevant_chunk_ids 标注
- [ ] 通过数据质量审核

#### 详细步骤

**4.1 选择代表性文档**

- 选择10-20份代表性文档
- 覆盖不同格式和业务场景

**4.2 问题类型设计**

| 问题类型 | 示例                 | 测试重点   |
| ---- | ------------------ | ------ |
| 事实查询 | "2024年营业收入是多少？"    | 精确数值检索 |
| 对比查询 | "2024年比2023年增长多少？" | 跨文档关联  |
| 汇总查询 | "各季度营业收入趋势？"       | 多数据聚合  |
| 表格查询 | "研发费用占营收比例？"       | 表格解析   |
| 概念解释 | "什么是净资产收益率？"       | 定义检索   |
| 流程查询 | "如何申请报销？"          | 步骤检索   |

**4.3 测试集生成流程**

```
┌─────────────────────────────────────────────────────────┐
│ 1. 选择代表性文档 (10-20份)                              │
├─────────────────────────────────────────────────────────┤
│ 2. 人工生成种子问题 (每类型20-30个)                      │
├─────────────────────────────────────────────────────────┤
│ 3. 制定标准答案                                          │
├─────────────────────────────────────────────────────────┤
│ 4. 标注 relevant_chunk_ids                              │
├─────────────────────────────────────────────────────────┤
│ 5. 模型辅助批量生成 (可选)                               │
└─────────────────────────────────────────────────────────┘
```

---

### 阶段5: 评估体系建立（1-2周）

#### 输入

- 测试数据集
- RAGFlow 评估系统

#### 输出

- 评估基准报告
- 参数配置建议
- 评估流程文档

#### 验证标准

- [ ] 完成基线评测
- [ ] 产出评估报告
- [ ] 确定关键参数影响
- [ ] 建立持续评估机制

#### 详细步骤

**5.1 理解评估指标**

| 指标        | 公式                | 含义     |
| --------- | ----------------- | ------ |
| Precision | \|R ∩ A\| / \|A\| | 检索精确度  |
| Recall    | \|R ∩ A\| / \|R\| | 检索召回率  |
| F1 Score  | 2×P×R/(P+R)       | 综合评价   |
| Hit Rate  | I(\|R ∩ A\|>0)    | 命中率    |
| MRR       | 1/rank₁           | 首位倒数排名 |

**5.2 参数优化测试**

| 参数                       | 测试值                     |
| ------------------------ | ----------------------- |
| chunk_token_num          | 128, 256, 512, 1024     |
| similarity_threshold     | 0.1, 0.2, 0.3, 0.5      |
| top_k                    | 3, 5, 10, 20            |
| vector_similarity_weight | 0.0, 0.3, 0.5, 0.7, 1.0 |

**5.3 建立评估基准**

- 使用默认参数运行评测
- 记录各指标基线值
- 识别效果瓶颈

---

### 阶段6: 原型验证与优化（2-3周）

#### 输入

- 评估报告和参数建议
- 业务场景需求

#### 输出

- PoC 原型系统
- 性能测试报告
- 优化建议清单

#### 验证标准

- [ ] 完成1-2个 PoC 场景
- [ ] 通过性能测试
- [ ] 用户验收通过
- [ ] 产出产品化方案

#### 详细步骤

**6.1 PoC 场景选择**

- **场景1**: 财务问答 (table 解析器)
- **场景2**: 技术支持 (book 解析器)
- **场景3**: 通用问答 (general 解析器)

**6.2 性能指标**

| 指标    | 说明          |
| ----- | ----------- |
| 检索延迟  | P50/P95/P99 |
| 生成延迟  | P50/P95/P99 |
| 端到端延迟 | P50/P95/P99 |
| 并发能力  | QPS         |
| 准确率   | 按问题类型统计     |

**6.3 问题分类与改进**

| 问题类型 | 示例      | 改进方向                  |
| ---- | ------- | --------------------- |
| 解析问题 | 文档解析不准确 | 调整解析器配置               |
| 检索问题 | 召回不相关   | 优化 chunking、threshold |
| 生成问题 | 答案质量差   | 优化 prompt、更换 LLM      |
| 性能问题 | 响应慢     | 优化索引、调整参数             |

---

## 三、资源需求

### 3.1 人力资源

| 角色    | 人数   | 职责                     |
| ----- | ---- | ---------------------- |
| 研究工程师 | 1-2人 | RAGFlow 深度研究、参数优化、评估体系 |
| 开发工程师 | 1-2人 | MVP 开发、数据收集、迭代优化       |
| 业务专家  | 1-2人 | 测试集构建、效果评估             |
| 项目经理  | 1人   | 协调资源、进度管理              |

### 3.2 硬件资源

| 资源      | 配置                | 用途         |
| ------- | ----------------- | ---------- |
| 开发服务器   | 16GB+ RAM, 8核 CPU | 源码调试       |
| GPU 服务器 | 24GB+ VRAM        | 本地模型部署（可选） |
| 存储空间    | 100GB+ SSD        | 文档存储和索引    |

### 3.3 数据需求

- 业务文档样本：10-20份代表性文档
- 测试数据集：50-100个标注问题
- 真实用户数据：从 MVP 收集

---

## 四、风险与应对

| 风险       | 应对措施          | 优先级 |
| -------- | ------------- | --- |
| 解析效果不达预期 | 提前进行多种解析器对比测试 | 高   |
| 性能瓶颈     | 预留性能测试和优化时间   | 高   |
| 数据质量差    | 建立数据清洗和审核机制   | 中   |
| 用户接受度低   | 小范围试点，收集反馈    | 中   |
| 人员变动     | 文档化知识，交接机制    | 低   |

---

## 五、检查点与里程碑

### 第一周目标

- [x] 完成 Docker 部署
- [x] 完成源码部署
- [x] 核心功能理解完成
- [x] 产出功能理解文档

### 第一个月目标

- [ ] 完成解析器研究
- [ ] 完成元数据与知识库管理研究
- [ ] 构建小规模测试集
- [ ] 完成基线评测

### 验收标准

- [ ] 测试集覆盖6种问题类型
- [ ] 评测报告包含关键指标分析
- [ ] PoC 系统通过用户验收
- [ ] 产出完整技术方案文档

---

## 六、下一步行动

### 立即可开始

1. ✅ Docker 快速部署，体验完整功能
2. ✅ 源码部署，建立调试环境
3. ✅ 探索评估系统 (`api/apps/evaluation_app.py`)

### 第一周目标

- [ ] 测试三种解析器效果
- [ ] 构建小规模测试集（10-20个问题）
- [ ] 完成元数据功能测试

### 第一个月目标

- [ ] 完成 1-2 个 PoC 场景
- [ ] 建立评估基准
- [ ] 输出详细技术方案

---

*文档版本: v1.1*
*创建日期: 2026-01-16*
*基于 RAGFlow 开源项目*
